# 1.常用命令


# 2.主要知识点

1.  一个完整的客户端请求-服务端响应-客户端获取到数据的过程
    1.  客户端连接：客户端发出connect命令，服务端就会产生一个Acceptable文件事件
        1.  acceptable文件事件处理器会将该'命令执行处理器'关联到readable文件事件
    2.  客户端发送命令：客户端write了某些命令，服务端就会有一个Readable文件事件
        1.  '命令请求处理器'执行命令，然后把'命令回复处理器'与writable事件关联
    3.  当客户端读取数据：客户端读取步骤2所发送的命令的响应时，服务端就会产生一个writable文件事件。
        1.  '命令回复处理器'负责将命令回复内容返回给客户端，并取消'命令回复处理器'与该socket的writable事件'的关联

    4.  存疑点：命令的执行和关联'命令回复处理器'到socket的writable事件之前'，客户端的尝试获取数据到来了呢，
        即socket的writable事件早于'关联'呢？
        回答：这只是一个细节实现而已，这里也包含着客户端如何和服务端交互。
            1.  全部都是由客户端主动吗？比如客户端主动发命令请求到服务端。
                服务端执行命令，并把结果放到一个地方。客户端再来读取命令结果——
                服务端这时才把数据发给客户端(如果客户端不来取，服务端不会主动发数据给客户端)。
            2.  在一种情况就是，客户端发起命令，然后，服务端执行，执行好之后，服务端主动发命令结果
                该客户端。

2.  定时事件和周期事件的实现
    1.  很简单：看时间处理器的返回值，如果是指定的定时时间常量，那么就是定时时间；
        如果是一个long，该long就是下次执行这个周期时间的德尔塔时间戳。
    2.  时间事件用一个无序链表组织
    3.  时间时间可以取消，当然有api了
    4.  当前redis之后一个周期时间——serverCron。

3.  serverCron中的逻辑模块
    1.   跟新服务器的各种统计信息-info命令
    2.  清理服务器中过期的key
    3.  关闭和清理链接失效的客户端
    4.  尝试进行aof或者rdb持久化链接
    5.  如果服务器是主服务器，对从服务器进行定期同步
    6.  如果处于集群模式，对进群进行定期同步和链接测试
    
4.  Redis服务器的主函数
    1.  init-server
    2.  while(服务器没有关闭){
            (时间/文件)事件处理
            1.  时间时间和文件时间的交织？
        }  
    3.  clean server
    
    
  

  
    
# 3.扩展
1.  多虑复用技术
    1.  epoll
    2.  kqueue
    3.  select

2.  服务器的统计信息可以用info命令查看
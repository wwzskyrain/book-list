# 数据库

# 1.相关命令
1.  expire、pExpire、expireAt 、pExpireAt
2.  persist key //消除以上四个命令对key设置的ttl
3.  ttl key //查看指定key的ttl


# 1.基本知识点

1.  多个db是按照数组来存(引用形式)
2.  每个db中用字典dict来保存键空间


# 2.小专题
1.  过期时间ttl和删除策略
    1.  过期数据的保存：redisDb结构中有'expires字典'，保存所有被设置了过期时间的过期时间值
    2.  过期的判定逻辑：和当前时间进行比较就可以了
    3.  过期删除key的时机（删除策略）：
        1.  定时删除
        2.  惰性删除
        3.  定期删除
        实际上，redis使用了'惰性删除'和'定期删除'；
        其中定期删除有点意思：
            1.  为了控制'定期删除'对server线程的影响——不要阻塞太久，定期删除在执行时间和做能作用范围上都做了限制
            2.  首先执行时机是在serverCron中
            3.  执行时间是有限制的，每次删除了一个key之后就会检查这个时间，到了的话，本次'定期删除'就执行结束了
            4.  是顺着db执行的，每次不需要完全遍历一遍，只需要在过期key中随即拣选一些key，来检查并删除

2.  读写键空间时会有一些列的维护操作
    1.  跟新命中计数器和不命中计数器
    2.  更新lru
    3.  已过期？删除--惰性删除 
    4.  被watch的key？它dirty了
    5.  dirty计数器
    6.  通知功能？
    
    
   


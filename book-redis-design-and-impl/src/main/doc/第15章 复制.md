# 1.基本内容和命令
1.  复制是指redis的主从结构部署，一主多从的。
2.  结点：主从结构中的server都是正常的server，在启动时，不需要参数，不需要配置

# 2.主从结构部署的过程
    1.  假设s1和s2和s3三个结点，我们要让s2和s3做s1的从节点
    2.  给s2发送命令 slave of s1，语义就是，s2啊去当s1的slave吧
    3.  s2这是就会
        1.  把s1的地址和端口作为设置为自己的主服务器
        2.  向s1套接字链接——废话
        3.  向s1发送ping命令
        4.  身份验证
        5.  发送监听端口信息，告诉s1自己的监听端口，给s1在info命令时使用。
            s1就根据这个端口，再次建立和s2的client式的链接
        6.  同步：
            1.  发送psync命令给s1；
            2.  s1开始bgsave；
            3.  s1把rdb文件传给s2
            4.  s2加载rdb文件
            5.  s1把bgsave之后到当下的'缓存下来命令'发给s2执行
            6.  同步完成；进入命令传播阶段
    4.  给s3发送命令 slave of s1，语义就是，s3啊去当s1的slave吧
        然后就和第3步一样，s3认s2位主子了。

# 3.命令传播阶段中的心跳检测
    1.  检查主从服务器的网络状态
    2.  辅助实现min-slave-to-write
    3.  检测命令丢失

# 4.异常：主从链接中断后恢复
    1.  假设是s2和s1链接中断并恢复了
    2.  s2中有个复制偏移量offset，发送给s1
    3.  s1内有个复制缓冲区buffer，如果发现offset还在buffer中，就把offeset之后的buffer都以此发给s2，s2执行命令，跟上同步。
    4.  如果发现offeset不在buffer，那就进行一次全同步，参见2.3


# 5.思考和总结
    1.复制这个主题，书中写的不深，而且想一想也没有太多复杂的。
    2.对比mysql中的复制，redis的复制真的很简单呀。
        1.没有复制内容的格式之分（mysql中有row和statement和max三种）
        2.不用考虑回滚，所以每一个从复制渠道传过来的命令，执行就完了
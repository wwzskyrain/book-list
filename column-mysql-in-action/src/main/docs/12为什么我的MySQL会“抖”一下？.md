

# 1.主要内容
1.  脏页：内存中的数据页一单被修改后，在没有被刷新到磁盘之前，就是脏页。我很奇怪，为什么叫做脏页，叫更新页不更好吗？而且人家哪里脏嘛
2.  刷脏页到磁盘的四个时机
    1.  redo-log满了
        1.  这时候要对redo-log中的记录，从checkpoint开始，找到对应的脏页，把脏页刷新到disk，然后checkpoint继续向前
    2.  内存满了
        1.  
    3.  正常关机 
    4.  后台进程在mysql空闲的时候刷盘
    5.  总结：3，4是对性能没有影响的；1和2则会很大的影响性能

3.  解决：
    1.  抖动：如果一个查询引发了脏页的刷盘，或者一个update导致redo-log满了而刷盘，则mysql就要花费很多资源去刷盘  
    2.  如何避免抖动
        1.  通过设置innodb_io_capacity参数——机器io的能力，让mysql知道不要为刷盘太快从而影响mysql的响应

# 2.我的思考和疑惑
1.  redo-log难道不是每次写入之后都要落盘的吗?WAL嘛，但是
    1.  是的，

2.  参数设置——这个不是我的思考，只是思考引发的资料查询
    1.  innodb_flush_log_at_trx_commit：
        1.  值为1(推荐)：事务每次提交都会将log-buffer中的日志写入到os buffer并调用fsync()刷盘到log-file-on-disk(真正的redo-log)
        2.  0：每秒提交写入os-buffer并调用fsync()；系统崩溃时，丢失1秒数据
        3.  2：每次提交都写入os-buffer，每秒调用fsync()。